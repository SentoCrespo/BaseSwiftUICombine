# ---------------------------------
# Domain target
# ---------------------------------

targets:
  PlatformNetworkLayerSpecific:

    ## Scheme
    scheme:
      testTargets:
        - PlatformNetworkLayerSpecificTests

    ## Properties
    type: framework
    platform: [iOS]
    platformSuffix: ''
        
    ## Sources
    sources: 

      ### Autogeneration files
      - path: Autogenerated
        includes: 
          - "**/*.swift"

      - path: Autogenerated
        includes: 
          - "**/*.py"
          - "**/*.config"
        buildPhase: none

      ### Target files
      - path: PlatformNetworkLayerSpecific
        excludes: 
          - Tests
          - "**/*_SPEC*.swift"
          - .swiftlint.yml
          - "**/*.config"
          - Info.plist ### Don't link info.plist

      ### Files added but not compiled
      - path: PlatformNetworkLayerSpecific
        includes: 
          - "**/*.config"
        buildPhase: none

      ### Root single files 
      - path: PlatformNetworkLayerSpecific/.swiftlint.yml
        buildPhase: none  

    ## Settings
    settings:
      base:
        SDKROOT: iphoneos
        PRODUCT_NAME: PlatformNetworkLayerSpecific
        INFOPLIST_FILE: $(SRCROOT)/PlatformNetworkLayerSpecific/Info.plist
        PRODUCT_BUNDLE_IDENTIFIER: com.wunderfleet.platform.networklayer.specific
        ENABLE_BITCODE: NO
        CLANG_ENABLE_MODULES: YES
        DEFINES_MODULE: YES
        USER_HEADER_SEARCH_PATHS: ../CarSharingSpecialisation/ExternSource
        SKIP_INSTALL: YES
        DYLIB_INSTALL_NAME_BASE: '@rpath'
      ### Specific settings
      configs:
        Debug:
          ENABLE_TESTABILITY: YES

    ## Pre-build scripts phase
    preBuildScripts:

      ### Code generation with Sourcery
      - name: Code Autogeneration
        script: |
                echo 'Generating Code...'
                ${SRCROOT}/Autogenerated/autoGenerateCodeConfig.py \
                    --sourceryBin 'scripts/codeGeneration/Sourcery-1.6.0/bin/sourcery' \
                    --config './PlatformNetworkLayerSpecific/Autogenerated/Autogeneration.config'
        basedOnDependencyAnalysis: false

      ### Enforce style conventions
      - name: Swift Lint
        script: |
                ${SRCROOT}/scripts/codeStyle/swiftlint-0.44.0 --config PlatformNetworkLayerSpecific/.swiftlint.yml
        basedOnDependencyAnalysis: false
      
    ## Dependencies
    dependencies:

      ## iOS SDKs
      - sdk: Foundation.framework
      
      ### Other targets
      - target: SharedUtils
      - target: UseCases
      - target: NetworkLayerRx
      
      ### Local Swift Packages
      - package: NetworkLayer
        product: NetworkLayer
      - package: NetworkLayer
        product: NetworkLayerURLSession
