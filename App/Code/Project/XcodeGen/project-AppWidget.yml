# ---------------------------------
# Widget target
# ---------------------------------

targets:
  ProjectWidget:

    ## Scheme
    scheme:
      testTargets:
        
    ## Properties
    type: app-extension
    platform: [iOS]
    platformSuffix: ''
    gatherCoverageData: false
        
    ## Sources
    sources:

      ### Target files
      - path: ProjectWidget
        excludes:
          - Tests
          - "**/*_SPEC*.swift"
          - .swiftlint.yml
          - "**/*.config"
          - Info.plist ### Don't link info.plist

      ### Files added but not compiled
      - path: ProjectWidget
        includes:
          - "**/*.config"
          - "Info.plist"
        buildPhase: none

    ## Settings
    settings:
      base:
        SDKROOT: iphoneos
        PRODUCT_NAME: AppWidget
        INFOPLIST_FILE: $(SRCROOT)/ProjectWidget/Info.plist
        PRODUCT_BUNDLE_IDENTIFIER: com.sento.project.appWidget
        ENABLE_BITCODE: NO
        DEFINES_MODULE: YES
        CLANG_ENABLE_MODULES: YES
        ENABLE_MODULE_VERIFIER: YES
        MODULE_VERIFIER_SUPPORTED_LANGUAGES: "objective-c objective-c++"
        MODULE_VERIFIER_SUPPORTED_LANGUAGE_STANDARDS: "gnu17 gnu++14"
        USER_HEADER_SEARCH_PATHS: ../ProjectSpecialisation/ExternSource
        SKIP_INSTALL: YES
        DYLIB_INSTALL_NAME_BASE: '@rpath'

      ### Specific settings
      configs:
        Debug:
          ENABLE_TESTABILITY: YES
          CODE_SIGN_IDENTITY: iPhone Developer
        Release:
          CODE_SIGN_IDENTITY: iPhone Distribution
          

    ## Pre-build scripts phase
    preBuildScripts:

      ### Code generation with Sourcery
      - name: Code Autogeneration
        script: |
                echo 'Generating Code...'
                ${SRCROOT}/../../Scripts/CodeGeneration/autoGenerateCodeConfig.py \
                  --sourceryBin '${SRCROOT}/../../Scripts/CodeGeneration/Sourcery-1.6.0/bin/sourcery' \
                  --config '${SRCROOT}/ProjectWidget/AutoGenerated/Autogeneration.config'
        basedOnDependencyAnalysis: false

      ### Enforce style conventions
      - name: Swift Lint
        script: |
                ${SRCROOT}/../../Scripts/CodeLinting/swiftlint-0.44.0 \
                  --config ${SRCROOT}/.swiftlint.yml
        basedOnDependencyAnalysis: false
      
    ## Dependencies
    dependencies:

      ## iOS SDKs
      - sdk: Foundation.framework
      - sdk: WidgetKit.framework
      - sdk: SwiftUI.framework
